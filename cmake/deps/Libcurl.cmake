if(WIN32)
    set(CMAKE_USE_OPENSSL OFF CACHE BOOL "" FORCE)
    set(CURL_USE_OPENSSL OFF CACHE BOOL "" FORCE)
    set(CMAKE_USE_MBEDTLS OFF CACHE BOOL "" FORCE)
    set(CURL_USE_MBEDTLS OFF CACHE BOOL "" FORCE)
    set(CMAKE_USE_SCHANNEL ON CACHE BOOL "" FORCE)
    set(CURL_USE_SCHANNEL ON CACHE BOOL "" FORCE)
    set(USE_OPENSSL OFF CACHE BOOL "" FORCE)
    set(USE_MBEDTLS OFF CACHE BOOL "" FORCE)
else()
    set(CMAKE_USE_OPENSSL OFF CACHE BOOL "" FORCE)
    set(CURL_USE_OPENSSL OFF CACHE BOOL "" FORCE)
    set(CMAKE_USE_MBEDTLS ON CACHE BOOL "" FORCE)
    set(CURL_USE_MBEDTLS ON CACHE BOOL "" FORCE)
    set(CMAKE_USE_SCHANNEL OFF CACHE BOOL "" FORCE)
    set(CURL_USE_SCHANNEL OFF CACHE BOOL "" FORCE)
    set(USE_OPENSSL OFF CACHE BOOL "" FORCE)
    set(USE_MBEDTLS ON CACHE BOOL "" FORCE)
endif()
set(CURL_USE_SECTRANSP OFF CACHE BOOL "" FORCE)
set(CURL_ZLIB ON CACHE BOOL "" FORCE)
set(CURL_DISABLE_LDAP ON CACHE BOOL "" FORCE)
set(ENABLE_THREADED_RESOLVER ON CACHE BOOL "" FORCE)
set(BUILD_CURL_EXE OFF CACHE BOOL "" FORCE)
set(CURL_ENABLE_SSL ON CACHE BOOL "" FORCE)
set(CURL_USE_LIBSSH2 OFF CACHE BOOL "" FORCE)
set(CURL_BROTLI OFF CACHE STRING "" FORCE)
set(CURL_ZSTD OFF CACHE STRING "" FORCE)
set(USE_NGHTTP2 OFF CACHE BOOL "" FORCE)
set(USE_LIBIDN2 OFF CACHE BOOL "" FORCE)
set(CURL_USE_LIBPSL OFF CACHE BOOL "" FORCE)

set(CMAKE_DISABLE_FIND_PACKAGE_PkgConfig ON)
cmake_path(APPEND ENVY_THIRDPARTY_CACHE_DIR "${ENVY_LIBCURL_ARCHIVE}" OUTPUT_VARIABLE _curl_archive)
set(_curl_url "${ENVY_LIBCURL_URL}")
if(EXISTS "${_curl_archive}")
    file(TO_CMAKE_PATH "${_curl_archive}" _curl_archive_norm)
    set(_curl_url "file://${_curl_archive_norm}")
endif()

FetchContent_Declare(libcurl
    URL ${_curl_url}
    URL_HASH SHA256=${ENVY_LIBCURL_SHA256}
)
FetchContent_MakeAvailable(libcurl)
FetchContent_GetProperties(libcurl)
unset(_curl_archive)
unset(_curl_archive_norm)
unset(_curl_url)
if(NOT TARGET CURL::libcurl)
    add_library(CURL::libcurl ALIAS libcurl)
endif()
if(TARGET libcurl_static)
    if(DEFINED _libssh2_primary_target)
        add_dependencies(libcurl_static ${_libssh2_primary_target})
    endif()
    set_target_properties(libcurl_static PROPERTIES INTERFACE_LINK_LIBRARIES "")
endif()
if(TARGET libcurl_shared)
    if(DEFINED _libssh2_primary_target)
        add_dependencies(libcurl_shared ${_libssh2_primary_target})
    endif()
    set_target_properties(libcurl_shared PROPERTIES INTERFACE_LINK_LIBRARIES "")
endif()
set(CURL_INCLUDE_DIR "${libcurl_SOURCE_DIR}/include" CACHE PATH "" FORCE)
set(_envy_libcurl_target libcurl)
if(TARGET libcurl_static)
    set(_envy_libcurl_target libcurl_static)
endif()

unset(CURL_LIBRARY CACHE)
unset(CURL_LIBRARIES CACHE)

set(CURL_LIBRARY "$<TARGET_FILE:${_envy_libcurl_target}>" CACHE STRING "" FORCE)
set(CURL_LIBRARIES "${CURL_LIBRARY}" CACHE STRING "" FORCE)
set(ENVY_LIBCURL_INCLUDE "${libcurl_SOURCE_DIR}/include")
set(ENVY_LIBCURL_BINARY_INCLUDE "${libcurl_BINARY_DIR}/include")
unset(_libssh2_primary_target)
unset(_envy_libcurl_output_name)
unset(_envy_libcurl_archive_name)
unset(_envy_libcurl_prefix)
unset(_envy_libcurl_suffix)
unset(_envy_prefix_len)
unset(_envy_suffix_len)
unset(_envy_name_len)
unset(_envy_suffix_start)
unset(_envy_libcurl_target)
unset(CMAKE_DISABLE_FIND_PACKAGE_PkgConfig)
